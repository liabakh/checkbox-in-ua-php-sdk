<?php

declare(strict_types=1);

namespace igorbunov\Checkbox\Mappers;

use igorbunov\Checkbox\Mappers\Receipts\ReceiptMapper;
use PHPUnit\Framework\TestCase;

class GetReceiptTest extends TestCase
{
    /** @var  string $jsonString */
    private $jsonString;

    public function setUp(): void
    {
        parent::setUp(); // TODO: Change the autogenerated stub

        $this->jsonString = '{
           "id":"c6a66550-44b8-4767-9bb0-66f0123c8efa",
           "type":"SELL",
           "transaction":{
              "id":"87dbd622-0f06-492b-9fa6-7c4237ff32dd",
              "type":"RECEIPT",
              "serial":4,
              "status":"DONE",
              "request_signed_at":"2020-10-05T11:20:33.322373+00:00",
              "request_received_at":"2020-10-05T11:20:34.371321+00:00",
              "response_status":"OK",
              "response_error_message":null,
              "created_at":"2020-10-05T11:20:32.531352+00:00",
              "updated_at":"2020-10-05T11:20:35.003179+00:00"
           },
           "serial":0,
           "status":"DONE",
           "goods":[
              {
                 "good":{
                    "code":"some code",
                    "barcode":"",
                    "name":"Биовак",
                    "header":"header good 1",
                    "footer":"footer good 1",
                    "uktzed":null,
                    "price":10,
                    "excise_barcodes" : []
                 },
                 "good_id":null,
                 "sum":0,
                 "quantity":1,
                 "is_return":false,
                 "taxes":[
                    {
                       "id":"77d9be25-f8c2-4378-a467-6b28976a26f2",
                       "code":1,
                       "label":"ПДВ",
                       "symbol":"А",
                       "rate":20,
                       "extra_rate":null,
                       "included":true,
                       "created_at":"2020-08-22T19:48:42+00:00",
                       "updated_at":null,
                       "value":0,
                       "extra_value":0
                    }
                 ],
                 "discounts":[
                    
                 ]
              }
           ],
           "payments":[
              {
                 "type":"CASH",
                 "value":10,
                 "label":"string"
              }
           ],
           "total_sum":0,
           "total_payment":10,
           "total_rest":9,
           "fiscal_code":"FapcbmT9Tkc",
           "fiscal_date":"2020-10-05T11:20:35.003179+00:00",
           "delivered_at":"2020-10-05T11:20:37.144020+00:00",
           "created_at":"2020-10-05T11:20:32.585347+00:00",
           "updated_at":"2020-10-05T11:20:37.144020+00:00",
           "taxes":[
              {
                 "id":"bd06c405-f4d9-4058-a863-931e5eafd7b2",
                 "code":1,
                 "label":"ПДВ",
                 "symbol":"А",
                 "rate":20,
                 "extra_rate":null,
                 "included":true,
                 "created_at":"2020-08-22T19:48:42+00:00",
                 "updated_at":null,
                 "value":0,
                 "extra_value":0
              }
           ],
           "discounts":[
              
           ],
           "header":null,
           "footer":"footer text",
           "barcode":"",
           "is_created_offline":false,
           "is_sent_dps":false,
           "sent_dps_at":null,
           "shift":{
              "id":"eae0b00a-b5ac-4959-9e1b-533593b55f3c",
              "serial":0,
              "status":"CLOSED",
              "z_report":{
                 "id":"1cd942ba-03a9-460a-a37e-00623a9c16ea",
                 "serial":0,
                 "is_z_report":true,
                 "payments":[
                    {
                       "id":"e8f06cd0-16d5-4423-b70a-9ff731c5d5f4",
                       "type":"CASH",
                       "label":"string",
                       "sell_sum":5010,
                       "return_sum":0,
                       "service_in":0,
                       "service_out":0
                    },
                    {
                       "id":"2a93eabd-d631-4193-87aa-6d84dbf72e4e",
                       "type":"CARD",
                       "label":"карта ВИЗА",
                       "sell_sum":5000,
                       "return_sum":0,
                       "service_in":0,
                       "service_out":0
                    },
                    {
                       "id":"c1548a47-f1f9-4407-b8ac-d86a1798d6f0",
                       "type":"CASH",
                       "label":"налик",
                       "sell_sum":20000,
                       "return_sum":0,
                       "service_in":0,
                       "service_out":0
                    }
                 ],
                 "taxes":[
                    {
                       "id":"8415be53-a629-4655-b834-22d1b94474df",
                       "code":2,
                       "label":"ПДВ Б",
                       "symbol":"Б",
                       "rate":7.0,
                       "sell_sum":0,
                       "return_sum":0,
                       "sales_turnover":0,
                       "returns_turnover":0,
                       "created_at":"2020-08-09T18:35:10+00:00"
                    },
                    {
                       "id":"cbcb6eb9-e0f6-47fc-9d80-53f76db19c49",
                       "code":123123,
                       "label":"1",
                       "symbol":"1",
                       "rate":1.0,
                       "sell_sum":0,
                       "return_sum":0,
                       "sales_turnover":0,
                       "returns_turnover":0,
                       "created_at":"2020-08-14T13:32:07+00:00"
                    },
                    {
                       "id":"bac4d177-801f-4354-b978-3d5ef987c17e",
                       "code":33333,
                       "label":"2",
                       "symbol":"1",
                       "rate":1.0,
                       "sell_sum":0,
                       "return_sum":0,
                       "sales_turnover":0,
                       "returns_turnover":0,
                       "created_at":"2020-08-14T13:34:49+00:00"
                    },
                    {
                       "id":"5479674d-b9e5-4dca-9436-ae475d2be949",
                       "code":12,
                       "label":"1",
                       "symbol":"1",
                       "rate":1.0,
                       "sell_sum":0,
                       "return_sum":0,
                       "sales_turnover":0,
                       "returns_turnover":0,
                       "created_at":"2020-08-14T16:21:59+00:00"
                    },
                    {
                       "id":"10240473-af38-4c0f-8ca7-2ff3fc956afd",
                       "code":13,
                       "label":"1",
                       "symbol":"1",
                       "rate":1.0,
                       "sell_sum":0,
                       "return_sum":0,
                       "sales_turnover":0,
                       "returns_turnover":0,
                       "created_at":"2020-08-17T09:41:16+00:00"
                    },
                    {
                       "id":"51555efb-a5c5-4394-b8be-e77fa594973e",
                       "code":10,
                       "label":"сбор",
                       "symbol":"Д",
                       "rate":1.2,
                       "sell_sum":0,
                       "return_sum":0,
                       "sales_turnover":0,
                       "returns_turnover":0,
                       "created_at":"2020-08-17T10:03:12+00:00"
                    },
                    {
                       "id":"f5121c97-ae90-4213-9522-5eca77161b91",
                       "code":9999,
                       "label":"1",
                       "symbol":"1",
                       "rate":1.0,
                       "sell_sum":0,
                       "return_sum":0,
                       "sales_turnover":0,
                       "returns_turnover":0,
                       "created_at":"2020-08-17T10:04:11+00:00"
                    },
                    {
                       "id":"fe67399b-345c-48d1-ad66-a7313e431ec1",
                       "code":5,
                       "label":"3",
                       "symbol":"1",
                       "rate":2.0,
                       "sell_sum":0,
                       "return_sum":0,
                       "sales_turnover":0,
                       "returns_turnover":0,
                       "created_at":"2020-08-17T10:06:31+00:00"
                    },
                    {
                       "id":"9c9378b3-4c11-45eb-be01-1723c54fc5d5",
                       "code":31,
                       "label":"12",
                       "symbol":"12",
                       "rate":12.0,
                       "sell_sum":0,
                       "return_sum":0,
                       "sales_turnover":0,
                       "returns_turnover":0,
                       "created_at":"2020-08-17T10:09:09+00:00"
                    },
                    {
                       "id":"01fb4fd6-4f22-4ab4-a457-15bcddbfb5b6",
                       "code":3,
                       "label":"Акцизний збір",
                       "symbol":"Ж111",
                       "rate":1.5,
                       "sell_sum":0,
                       "return_sum":0,
                       "sales_turnover":0,
                       "returns_turnover":0,
                       "created_at":"2020-08-17T11:23:01+00:00"
                    },
                    {
                       "id":"908f93a5-74c0-496c-91fe-1ea7324762d8",
                       "code":123124,
                       "label":"1",
                       "symbol":"1",
                       "rate":1.0,
                       "sell_sum":0,
                       "return_sum":0,
                       "sales_turnover":0,
                       "returns_turnover":0,
                       "created_at":"2020-08-17T12:01:18+00:00"
                    },
                    {
                       "id":"ca15f1be-0df2-4b57-a5b9-be9e1c8e9b7c",
                       "code":2,
                       "label":"ПДВ+акциз",
                       "symbol":"Б",
                       "rate":20.0,
                       "sell_sum":0,
                       "return_sum":0,
                       "sales_turnover":0,
                       "returns_turnover":0,
                       "created_at":"2020-08-22T19:48:14+00:00"
                    },
                    {
                       "id":"4586f0a1-19bd-4a7e-a1eb-65f70d0cd35d",
                       "code":3,
                       "label":"Акциз",
                       "symbol":"В",
                       "rate":0.0,
                       "sell_sum":0,
                       "return_sum":0,
                       "sales_turnover":0,
                       "returns_turnover":0,
                       "created_at":"2020-08-22T19:49:12+00:00"
                    },
                    {
                       "id":"54f98b20-b966-4e2c-895b-109b6a2ab6c5",
                       "code":4,
                       "label":"без пдв",
                       "symbol":"Г",
                       "rate":0.0,
                       "sell_sum":0,
                       "return_sum":0,
                       "sales_turnover":0,
                       "returns_turnover":0,
                       "created_at":"2020-08-22T19:49:36+00:00"
                    },
                    {
                       "id":"d63803bb-bba7-45ea-a964-af7460b39b97",
                       "code":1234567890,
                       "label":"3 група",
                       "symbol":"А і Б",
                       "rate":5.0,
                       "sell_sum":0,
                       "return_sum":0,
                       "sales_turnover":0,
                       "returns_turnover":0,
                       "created_at":"2020-09-25T16:20:25+00:00"
                    },
                    {
                       "id":"d586fdb3-f1fa-4c23-bd5d-1b0946bcb31e",
                       "code":8,
                       "label":"2 група",
                       "symbol":"В",
                       "rate":3.0,
                       "sell_sum":0,
                       "return_sum":0,
                       "sales_turnover":0,
                       "returns_turnover":0,
                       "created_at":"2020-09-25T16:24:42+00:00"
                    },
                    {
                       "id":"6840d018-4dcd-4c46-9d52-1be32e293e67",
                       "code":123125,
                       "label":"Без ПДВ",
                       "symbol":"івфа",
                       "rate":0.0,
                       "sell_sum":0,
                       "return_sum":0,
                       "sales_turnover":0,
                       "returns_turnover":0,
                       "created_at":"2020-10-02T12:46:10+00:00"
                    },
                    {
                       "id":"c8ae424d-32bd-4afa-9342-ce92a5c96a4d",
                       "code":1,
                       "label":"ПДВ",
                       "symbol":"А",
                       "rate":20.0,
                       "sell_sum":4999,
                       "return_sum":0,
                       "sales_turnover":30000,
                       "returns_turnover":0,
                       "created_at":"2020-08-22T19:48:42+00:00"
                    },
                    {
                       "id":"072d5c52-1817-4af5-a3ed-ccca468d1eda",
                       "code":1,
                       "label":"ПДВ А",
                       "symbol":"А",
                       "rate":20.0,
                       "sell_sum":2,
                       "return_sum":0,
                       "sales_turnover":10,
                       "returns_turnover":0,
                       "created_at":"2020-08-09T18:34:04+00:00"
                    }
                 ],
                 "sell_receipts_count":6,
                 "return_receipts_count":0,
                 "transfers_count":0,
                 "transfers_sum":0,
                 "created_at":"2020-10-06T06:12:28.558017+00:00",
                 "updated_at":null
              },
              "opened_at":"2020-10-05T10:53:15.184844+00:00",
              "closed_at":"2020-10-06T06:13:37.047473+00:00",
              "initial_transaction":{
                 "id":"c301b216-10eb-4b0e-b21a-47dab1b56a64",
                 "type":"SHIFT_OPEN",
                 "serial":0,
                 "status":"DONE",
                 "request_signed_at":"2020-10-05T10:53:12.259694+00:00",
                 "request_received_at":"2020-10-05T10:53:13.315504+00:00",
                 "response_status":"OK",
                 "response_error_message":null,
                 "created_at":"2020-10-05T10:14:36.171086+00:00",
                 "updated_at":"2020-10-05T10:53:15.166567+00:00"
              },
              "closing_transaction":{
                 "id":"14216376-dc6b-4138-bb46-b516e6b7848e",
                 "type":"Z_REPORT",
                 "serial":4,
                 "status":"DONE",
                 "request_signed_at":"2020-10-06T06:13:35.260304+00:00",
                 "request_received_at":"2020-10-06T06:13:36.391860+00:00",
                 "response_status":"OK",
                 "response_error_message":null,
                 "created_at":"2020-10-06T06:12:28.454065+00:00",
                 "updated_at":"2020-10-06T06:13:37.038331+00:00"
              },
              "created_at":"2020-10-05T10:14:36.171086+00:00",
              "updated_at":"2020-10-06T06:13:37.082144+00:00",
              "balance":{
                 "initial":0,
                 "balance":25010,
                 "cash_sales":25010,
                 "card_sales":5000,
                 "cash_returns":0,
                 "card_returns":0,
                 "service_in":0,
                 "service_out":0,
                 "updated_at":"2020-10-05T11:45:47.668773+00:00"
              },
              "taxes":[
                 {
                    "id":"00a8ab3b-ceaf-48c1-abae-d888cb726869",
                    "code":2,
                    "label":"ПДВ Б",
                    "symbol":"Б",
                    "rate":7,
                    "extra_rate":null,
                    "included":true,
                    "created_at":"2020-08-09T18:35:10+00:00",
                    "updated_at":null,
                    "sales":0,
                    "returns":0,
                    "sales_turnover":0,
                    "returns_turnover":0
                 },
                 {
                    "id":"44678bd8-bc5e-4022-98e7-c406b442983d",
                    "code":123123,
                    "label":"1",
                    "symbol":"1",
                    "rate":1,
                    "extra_rate":null,
                    "included":true,
                    "created_at":"2020-08-14T13:32:07+00:00",
                    "updated_at":null,
                    "sales":0,
                    "returns":0,
                    "sales_turnover":0,
                    "returns_turnover":0
                 },
                 {
                    "id":"7bc3c5fa-d8c0-4201-ab71-8d9c993b3695",
                    "code":33333,
                    "label":"2",
                    "symbol":"1",
                    "rate":1,
                    "extra_rate":null,
                    "included":true,
                    "created_at":"2020-08-14T13:34:49+00:00",
                    "updated_at":null,
                    "sales":0,
                    "returns":0,
                    "sales_turnover":0,
                    "returns_turnover":0
                 },
                 {
                    "id":"ad800403-fa13-4c18-ba02-09af3110d455",
                    "code":12,
                    "label":"1",
                    "symbol":"1",
                    "rate":1,
                    "extra_rate":1,
                    "included":true,
                    "created_at":"2020-08-14T16:21:59+00:00",
                    "updated_at":null,
                    "sales":0,
                    "returns":0,
                    "sales_turnover":0,
                    "returns_turnover":0
                 },
                 {
                    "id":"0e209daf-99e5-42e6-be8e-30bf9847c30d",
                    "code":13,
                    "label":"1",
                    "symbol":"1",
                    "rate":1,
                    "extra_rate":1,
                    "included":true,
                    "created_at":"2020-08-17T09:41:16+00:00",
                    "updated_at":null,
                    "sales":0,
                    "returns":0,
                    "sales_turnover":0,
                    "returns_turnover":0
                 },
                 {
                    "id":"6e20fff9-275b-4c00-85ba-e29a588ac47c",
                    "code":10,
                    "label":"сбор",
                    "symbol":"Д",
                    "rate":1,
                    "extra_rate":1,
                    "included":true,
                    "created_at":"2020-08-17T10:03:12+00:00",
                    "updated_at":null,
                    "sales":0,
                    "returns":0,
                    "sales_turnover":0,
                    "returns_turnover":0
                 },
                 {
                    "id":"caee0cca-7e49-491e-bb2c-30056de805e0",
                    "code":9999,
                    "label":"1",
                    "symbol":"1",
                    "rate":1,
                    "extra_rate":1,
                    "included":true,
                    "created_at":"2020-08-17T10:04:11+00:00",
                    "updated_at":null,
                    "sales":0,
                    "returns":0,
                    "sales_turnover":0,
                    "returns_turnover":0
                 },
                 {
                    "id":"b89cbe0d-f59f-46d6-aa7f-2800ebd4c057",
                    "code":5,
                    "label":"3",
                    "symbol":"1",
                    "rate":2,
                    "extra_rate":4,
                    "included":true,
                    "created_at":"2020-08-17T10:06:31+00:00",
                    "updated_at":null,
                    "sales":0,
                    "returns":0,
                    "sales_turnover":0,
                    "returns_turnover":0
                 },
                 {
                    "id":"c954e34b-753e-4164-b2b2-45e1cc201b00",
                    "code":31,
                    "label":"12",
                    "symbol":"12",
                    "rate":12,
                    "extra_rate":1,
                    "included":true,
                    "created_at":"2020-08-17T10:09:09+00:00",
                    "updated_at":null,
                    "sales":0,
                    "returns":0,
                    "sales_turnover":0,
                    "returns_turnover":0
                 },
                 {
                    "id":"634eb7bc-dd27-4381-b3e3-90b886d2a6ee",
                    "code":3,
                    "label":"Акцизний збір",
                    "symbol":"Ж111",
                    "rate":1,
                    "extra_rate":5,
                    "included":true,
                    "created_at":"2020-08-17T11:23:01+00:00",
                    "updated_at":null,
                    "sales":0,
                    "returns":0,
                    "sales_turnover":0,
                    "returns_turnover":0
                 },
                 {
                    "id":"501bcc4b-f6ea-4e7a-a5b4-0da26bd4b659",
                    "code":123124,
                    "label":"1",
                    "symbol":"1",
                    "rate":1,
                    "extra_rate":1,
                    "included":true,
                    "created_at":"2020-08-17T12:01:18+00:00",
                    "updated_at":null,
                    "sales":0,
                    "returns":0,
                    "sales_turnover":0,
                    "returns_turnover":0
                 },
                 {
                    "id":"9b2ae879-fa31-4ac4-87b5-d364f254f2fc",
                    "code":2,
                    "label":"ПДВ+акциз",
                    "symbol":"Б",
                    "rate":20,
                    "extra_rate":5,
                    "included":true,
                    "created_at":"2020-08-22T19:48:14+00:00",
                    "updated_at":null,
                    "sales":0,
                    "returns":0,
                    "sales_turnover":0,
                    "returns_turnover":0
                 },
                 {
                    "id":"4ca2fc14-fa65-4f73-8dd9-8f4ce4e2290b",
                    "code":3,
                    "label":"Акциз",
                    "symbol":"В",
                    "rate":0,
                    "extra_rate":5,
                    "included":true,
                    "created_at":"2020-08-22T19:49:12+00:00",
                    "updated_at":null,
                    "sales":0,
                    "returns":0,
                    "sales_turnover":0,
                    "returns_turnover":0
                 },
                 {
                    "id":"ed511784-ad10-4325-b243-ee66bd123a2e",
                    "code":4,
                    "label":"без пдв",
                    "symbol":"Г",
                    "rate":0,
                    "extra_rate":null,
                    "included":true,
                    "created_at":"2020-08-22T19:49:36+00:00",
                    "updated_at":null,
                    "sales":0,
                    "returns":0,
                    "sales_turnover":0,
                    "returns_turnover":0
                 },
                 {
                    "id":"48864912-d7f5-4d29-ada3-b8d26d54dd32",
                    "code":1234567890,
                    "label":"3 група",
                    "symbol":"А і Б",
                    "rate":5,
                    "extra_rate":0,
                    "included":true,
                    "created_at":"2020-09-25T16:20:25+00:00",
                    "updated_at":null,
                    "sales":0,
                    "returns":0,
                    "sales_turnover":0,
                    "returns_turnover":0
                 },
                 {
                    "id":"fd02ac7f-8c53-4fdd-bd4f-c8c4dd652f0b",
                    "code":8,
                    "label":"2 група",
                    "symbol":"В",
                    "rate":3,
                    "extra_rate":1,
                    "included":true,
                    "created_at":"2020-09-25T16:24:42+00:00",
                    "updated_at":null,
                    "sales":0,
                    "returns":0,
                    "sales_turnover":0,
                    "returns_turnover":0
                 },
                 {
                    "id":"f489b1b1-e532-43e4-86e0-6269d41ff3dd",
                    "code":123125,
                    "label":"Без ПДВ",
                    "symbol":"івфа",
                    "rate":0,
                    "extra_rate":null,
                    "included":true,
                    "created_at":"2020-10-02T12:46:10+00:00",
                    "updated_at":null,
                    "sales":0,
                    "returns":0,
                    "sales_turnover":0,
                    "returns_turnover":0
                 },
                 {
                    "id":"bd06c405-f4d9-4058-a863-931e5eafd7b2",
                    "code":1,
                    "label":"ПДВ",
                    "symbol":"А",
                    "rate":20,
                    "extra_rate":null,
                    "included":true,
                    "created_at":"2020-08-22T19:48:42+00:00",
                    "updated_at":null,
                    "sales":4999,
                    "returns":0,
                    "sales_turnover":30000,
                    "returns_turnover":0
                 },
                 {
                    "id":"52ce512c-e10f-4784-816a-264b5d26d0be",
                    "code":1,
                    "label":"ПДВ А",
                    "symbol":"А",
                    "rate":20,
                    "extra_rate":null,
                    "included":true,
                    "created_at":"2020-08-09T18:34:04+00:00",
                    "updated_at":null,
                    "sales":2,
                    "returns":0,
                    "sales_turnover":10,
                    "returns_turnover":0
                 }
              ],
              "cash_register":{
                 "id":"3e650f3e-09b9-44e4-baea-f40f143cbb00",
                 "fiscal_number":"4000037367",
                 "created_at":"2020-09-28T10:57:51+00:00",
                 "updated_at":"2020-11-06T13:04:56.401242+00:00"
              },
              "cashier":{
                 "id":"b24a5d01-9660-4269-baf9-ffda938c8f56",
                 "full_name":"usertestkey 82",
                 "nin":"",
                 "key_id":"f8d4d9a394699c44616a8d84250f2cdc08331007d915f652e436b94e067643ed",
                 "signature_type":"AGENT",
                 "created_at":"2020-09-29T11:38:55+00:00",
                 "updated_at":"2020-09-29T11:52:36+00:00"
              }
           }
        }';
    }

    public function testMapShiftWithNull(): void
    {
        $this->assertNull(
            (new ReceiptMapper())->jsonToObject(null)
        );
    }

    public function testMapGetShiftWithJson(): void
    {
        $jsonResponse = json_decode($this->jsonString, true);

        $mapped = (new ReceiptMapper())->jsonToObject($jsonResponse);

        $this->assertEquals(
            'c6a66550-44b8-4767-9bb0-66f0123c8efa',
            $mapped->id
        );
        $this->assertEquals(
            '87dbd622-0f06-492b-9fa6-7c4237ff32dd',
            $mapped->transaction->id
        );
        $this->assertEquals(
            'Биовак',
            $mapped->goods->results[0]->good->name
        );
        $this->assertEquals(
            '77d9be25-f8c2-4378-a467-6b28976a26f2',
            $mapped->goods->results[0]->taxes->results[0]->id
        );
        $this->assertEquals(
            'CASH',
            $mapped->payments->results[0]->type
        );
        $this->assertEquals(
            'eae0b00a-b5ac-4959-9e1b-533593b55f3c',
            $mapped->shift->id
        );
        $this->assertEquals(
            'e8f06cd0-16d5-4423-b70a-9ff731c5d5f4',
            $mapped->shift->z_report->payments->payments[0]->id
        );
    }
}
